<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetrsi hecho en java script</title>

    <link rel="stylesheet" href="./styles/styles.css">
    <!--se importa libreria de p5.js para poder manejar mejor el canvas-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script>
    <scrip src="./scripts/tetris.js"></scrip>
</head>
<body>

    <div class="titulo">
        <h1 id="letrat">T</h1>
        <h1 id="letrae">E</h1>
        <h1 id="letrat2">T</h1>
        <h1 id="letrar">R</h1>
        <h1 id="letrai">I</h1>
        <h1 id="letras">S</h1>
    </div>
    <script src="./scripts/Tablerotetris.js"></script>
    <script src="./scripts/tetrimino.js"></script>
    <!--se hace un pequeño script dentro del html 
    por que se esta trabajando con una liberia por lo tanto 
    se define desde acá la parte del canvas donde se dibujrá 
    cada celda -->

    <script>

        const margen_tablero = 10
        let regulador_velocidad_teclas = 0
        let regulador_de_caida = 0
        let lineas_hechas = 0

    /*se simula la gravedad para que las piezas 
    caigan cada cierta cantidad de tiempo*/

    setInterval(() => {
            if (millis() - regulador_de_caida < 300) {
                return
            }
            regulador_de_caida = millis()
            tetrimino.moverAbajo()
        }, 500);


    /* tanto la función setup como draw, con nativas de p5.js 
    esa es una de las ventajas de esta liberia, sirve para 
    ajustar las propiedades iniciales de los objetos y variables*/

    function setup(){
        createCanvas(900,600)
        tablero = new Tablero()
        crearMapeoBaseTetriminos()
        tetromino = new Tetrimino()
        resizeCanvas(
            tablero.ancho + 2 * margen_tablero,
            tablero.alto + 2 * margen_tablero + 2*tablero.lado_celda
            )
    }

    /* la función draw sirve para dar instrucciones especificas 
    de dibujo en el canvas como el color de fondo, dibujar el tablero, el tetromino*/

    function draw(){
        clear()
        dibujarPuntaje()
        tablero.dibujar()
        tetromino.dibujar()
        keyEventsTetris()
    }

    function dibujarPuntaje(){
        push()
        textSize(20)
        strokeWeight(2)
        stroke("black")
        fill("white")
        text(
            "lineas: " + lineas_hechas,
            tablero.posicion.x,
            tablero.posicion.y - tablero.lado_celda / 2
        )
        pop()
    }

    let limite_regulador_velocidad_teclas = 100

    /*Esta funcion permite asignarle controles del teclado para mover la figura en las direcciones de izquierda
    derecha y abajo, tambiens e uso un regulador de velocidad para que los tetrominos no se muevan tan rapido 
    por el canvas ajustado en milisegundos*/

    function keyEventsTetris(){
        if(millis() - regulador_velocidad_teclas < limite_regulador_velocidad_teclas ){
            return
        }

        limite_regulador_velocidad_teclas = 100
        regulador_velocidad_teclas = millis() 

        if(keyIsDown(RIGHT_ARROW)){
            tetromino.moverDerecha()
            regulador_de_caida = millis()
        }
        if(keyIsDown(LEFT_ARROW)){
            tetromino.moverIzquierda()
            regulador_de_caida = millis()
        }
        if(keyIsDown(DOWN_ARROW)){
            tetromino.moverAbajo()
            regulador_de_caida = millis()
        }
        if(keyIsDown(UP_ARROW)){
            limite_regulador_velocidad_teclas = 150
            tetromino.girar()
            regulador_de_caida = millis()
        }
        if(keyIsDown(32)){
            limite_regulador_velocidad_teclas = 200
            tetromino.ponerEnElFondo()
            regulador_de_caida = millis()
        }
    }
    </script>

</body>
</html>